<div class="traceur-container">
    <header class="traceur-header">
        <h1>Traceur Spatial</h1>
        <a routerLink="/"
           class="nav-link">Retour à l'accueil</a>
    </header>

    <!-- Demande de permission de localisation -->
    <div class="permission-request"
         *ngIf="!locationPermissionGranted">
        <div class="alert-box warning">
            <h3>Accès à la Localisation Requis</h3>
            <p>Cette chasse au trésor utilise le GPS de votre appareil pour vérifier quand vous atteignez
                chaque lieu. Sans accès à la localisation, vous ne pourrez pas
                progresser dans la chasse.</p>
            <button class="button primary"
                    (click)="requestLocationPermission()">
                Activer la Localisation
            </button>
        </div>
    </div>

    <!-- Indicateur de proximité -->
    <div class="proximity-indicator"
         *ngIf="currentDistance !== null">
        <div class="distance-info">
            <span class="distance-icon"
                  [ngClass]="getDistanceColorClass()">
                {{ getDistanceIcon() }}
            </span>
            <span class="distance-text">Distance : {{ formatDistance(currentDistance) }}</span>
        </div>

        <div class="distance-bar-container">
            <div class="distance-bar">
                <div class="distance-progress"
                     [style.width.%]="getDistanceProgress()"
                     [ngClass]="{'glow-effect': isCloseToTarget()}">
                </div>
            </div>
            <div class="distance-labels">
                <span class="far-label">50m</span>
                <span class="close-label">10m</span>
            </div>
        </div>

        <div class="location-status"
             *ngIf="isCloseToTarget(10)">
            <p>Vous êtes à proximité ! Restez à moins de 10 mètres pour débloquer.</p>
        </div>
    </div>

    <!-- Mode Debug -->
    <div class="debug-panel"
         *ngIf="debugMode">
        <h3>Mode Débogage</h3>

        <div class="debug-info"
             *ngIf="currentStep">
            <div class="info-row">
                <span class="label">Étape Actuelle :</span>
                <span class="value">{{ currentStep.title }}</span>
            </div>

            <div class="info-row"
                 *ngIf="currentCoordinates">
                <span class="label">Vos Coordonnées :</span>
                <span class="value">
                    {{ currentCoordinates.lat.toFixed(6) }}, {{ currentCoordinates.lng.toFixed(6) }}
                </span>
            </div>

            <div class="info-row"
                 *ngIf="currentStep.coordinates">
                <span class="label">Coordonnées Cibles :</span>
                <span class="value">
                    {{ currentStep.coordinates.lat.toFixed(6) }}, {{ currentStep.coordinates.lng.toFixed(6) }}
                </span>
            </div>

            <div class="info-row">
                <span class="label">Distance à la Cible :</span>
                <span class="value"
                      [ngClass]="{'near-target': isCloseToTarget()}">
                    {{ formatDistance(currentDistance) }}
                </span>
            </div>
        </div>

        <div class="debug-actions">
            <button class="button accent"
                    (click)="simulateLocation()">
                Simuler l'arrivée
            </button>
            <button class="button warning"
                    (click)="resetHunt()">
                Réinitialiser la chasse
            </button>
        </div>
    </div>

    <footer class="traceur-footer">
        <div class="debug-toggle"
             (click)="toggleDebug()">
            <span>{{ debugMode ? 'Mode Débogage Activé' : '⚙️' }}</span>
        </div>
    </footer>
</div>